---
import Layout from '../layouts/Layout.astro';
import LayoutSimple from '../layouts/Layout-Simple.astro';
import Card from '../components/Card.astro';

---

<LayoutSimple title='hand-tracking'>
    
    <a-scene video-material="videoSelector: #video-1; modelSelector: #screens-model">
        <a-assets>
            <!-- Single source video. -->
            <video
                id="video-1"
                loop="true"
                preload="true"
                crossorigin="anonymous"
                src="https://ourexperiments.me/Pictures/ImmersiveStand_Flythrough.mp4"
            >
            </video>

            <a-asset-item id="screens" src="/NMDC Screens.glb"></a-asset-item>

        </a-assets>
        <!-- Middle panel, 2560x1920 pixels
        <!-- <a-plane position="0 1.5 -4" rotation="0 0 0" width="2.56" height="1.92" color="#FFF" material="side:double; src:#video-1; repeat: 0.3637 1; offset: 0.318 0.0"></a-plane> -->

        <!-- Left panel, 2240x1920 pixels, rotated 90 degrees -->
        <!-- <a-plane position="-1.28 1.5 -2.9" rotation="0 90 0" width="2.24" height="1.92" color="#FFF" material="side:double; src:#video-2; repeat: 0.318 1; offset: 0.0 0.0"></a-plane> -->

        <!-- Right panel, 2240x1920 pixels, rotated -90 degrees -->
        <!-- <a-plane position="1.28 1.5 -2.9" rotation="0 -90 0" width="2.24" height="1.92" color="#FFF" material="side:double; src:#video-3; repeat: 0.318 1; offset: 0.682 0.0"></a-plane> -->
        <a-entity id="screens-model" gltf-model="#screens" position="0 1.5 -2.9" rotation="180 -90 0" scale="1.12 1.12 1.12"></a-entity>
        <!-- Bottom panel, 2240x1920 pixels, rotated -90 degrees -->
        <a-plane id="floor" position="0 0.54 -2.9" rotation="90 0 0" width="2.56" height="2.24" color="#AAA" material="side:double"></a-plane>

        <!-- Top panel, 2240x1920 pixels, rotated -90 degrees -->
        <a-plane id="ceiling" position="0 2.46 -2.9" rotation="90 0 0" width="2.56" height="2.24" color="#AAA" material="side:double"></a-plane>

        <a-camera
            user-height="0.5"
            position="0 1.5 -2.3"
            fov="130"
            >
        </a-camera>
    </a-scene>
</LayoutSimple>

<script>
    window.addEventListener('click', function () { 
        document.querySelector('#video-1').play();

        console.log("Play");
    });
    AFRAME.registerComponent('video-material', {
        schema: {
            videoSelector: { type: 'selector' },
            modelSelector: { type: 'selector' }
        },

        init: function() {
            const videoEl = this.data.videoSelector;
            const modelEl = this.data.modelSelector;
            const sceneEl = this.el.sceneEl;
            const videoTexture = new AFRAME.THREE.VideoTexture(videoEl);

            // videoEl.play();

            modelEl.addEventListener('model-loaded', () => {
                const mesh = modelEl.getObject3D('mesh');
                if (!mesh) return;

                mesh.traverse((node) => {
                    if (node.isMesh) {
                        node.material = new AFRAME.THREE.MeshStandardMaterial({ 
                            color: 0xffffff, 
                            map: videoTexture,
                            emissiveMap: videoTexture,
                            side: AFRAME.THREE.DoubleSide
                        });
                        node.material.needsUpdate = true;
                    }
                });
            });

            sceneEl.background = videoTexture;
        }
    });
</script>
		